{% extends "layout/base.html" %}

{% block title %}Báo Cáo Thống Kê{% endblock %}

{% block content %}
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script src="{{ url_for('static', filename='js/baocao.js') }}"></script>

<script>
        document.addEventListener('DOMContentLoaded', function() {
            // Lấy dữ liệu từ Jinja2 render ra
            const labels = {{ month_labels | tojson }};
            const revenueData = {{ revenue_datasets | tojson }};
            const memberData = {{ member_values | tojson }};

            // Gọi hàm từ file baocao.js
            renderCharts(labels, revenueData, memberData);
        });
</script>

<div class="container py-5">
    <div class="row mb-4">
        <div class="col-12">
            <div class="p-4 rounded-3 text-white shadow-sm d-flex align-items-center justify-content-between"
                 style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);">
                <div>
                    <h2 class="fw-bold mb-1">Báo Cáo Thống Kê - Năm {{ selected_year }}</h2>
                    <p class="mb-0 opacity-75">Tổng hợp hiệu quả kinh doanh và tăng trưởng hội viên</p>
                </div>
                <form class="d-flex align-items-center bg-white rounded-pill p-1">
                    <input type="number" name="year" class="form-control border-0 shadow-none rounded-pill"
                           value="{{ selected_year }}" style="width: 100px;">
                    <button type="submit" class="btn btn-primary rounded-pill px-3">Xem</button>
                </form>
            </div>
        </div>
    </div>

    <div class="row mb-4">
        <div class="col-md-4">
            <div class="card border-0 shadow-sm h-100">
                <div class="card-body d-flex align-items-center">
                    <div class="rounded-circle p-3 me-3 text-white" style="background-color: #28a745;">
                        <i class="fas fa-users fa-2x"></i>
                    </div>
                    <div>
                        <h6 class="text-muted text-uppercase mb-1">Hội viên Active</h6>
                        <h3 class="fw-bold mb-0">{{ total_active }}</h3>
                        <small class="text-success fw-bold">Đang còn hạn gói tập</small>
                    </div>
                </div>
            </div>
        </div>

        <div class="col-md-4">
            <div class="card border-0 shadow-sm h-100">
                <div class="card-body d-flex align-items-center">
                    <div class="rounded-circle p-3 me-3 text-white" style="background-color: #fd7e14;">
                        <i class="fas fa-user-plus fa-2x"></i>
                    </div>
                    <div>
                        <h6 class="text-muted text-uppercase mb-1">Đăng ký mới (Năm {{ selected_year }})</h6>
                        <h3 class="fw-bold mb-0">{{ member_values | sum }}</h3>
                        <small class="text-muted">Tổng hội viên mới trong năm</small>
                    </div>
                </div>
            </div>
        </div>

        <div class="col-md-4">
            <div class="card border-0 shadow-sm h-100">
                <div class="card-body d-flex align-items-center">
                    <div class="rounded-circle p-3 me-3 text-white" style="background-color: #6610f2;">
                        <i class="fas fa-coins fa-2x"></i>
                    </div>
                    <div>
                        <h6 class="text-muted text-uppercase mb-1">Tổng Doanh Thu (Năm {{ selected_year }})</h6>
                        <h3 class="fw-bold mb-0 text-primary">{{ "{:,.0f}".format(total_revenue) }} VNĐ</h3>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div class="row g-4">
        <div class="col-lg-8">
            <div class="card border-0 shadow-sm h-100">
                <div class="card-header bg-white border-0 py-3">
                    <h5 class="fw-bold text-primary mb-0"><i class="fas fa-chart-line me-2"></i>Chi Tiết Doanh Thu Theo Gói</h5>
                </div>
                <div class="card-body">
                    <canvas id="revenueChart" style="height: 350px;"></canvas>
                </div>
            </div>
        </div>

        <div class="col-lg-4">
            <div class="card border-0 shadow-sm h-100">
                <div class="card-header bg-white border-0 py-3">
                    <h5 class="fw-bold text-info mb-0"><i class="fas fa-chart-bar me-2"></i>Tăng Trưởng Hội Viên</h5>
                </div>
                <div class="card-body">
                    <canvas id="memberChart" style="height: 350px;"></canvas>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}