<link rel="stylesheet" href="{{ url_for('static', filename='css/header.css') }}">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

<nav class="navbar navbar-expand-lg navbar-light bg-light shadow-sm">
    <div class="container-fluid">
        <a class="navbar-brand fw-bold text-primary" href="{{ url_for('index') }}">
            <i class="fas fa-dumbbell me-2"></i>GYM FITNESS
        </a>

        <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav">
            <span class="navbar-toggler-icon"></span>
        </button>

        <div class="collapse navbar-collapse" id="navbarNav">
            <ul class="navbar-nav ms-auto align-items-center">

                {# ================== 1. KHU VỰC CHUNG (AI CŨNG THẤY) ================== #}
                <li class="nav-item">
                    <a class="nav-link" href="{{ url_for('index') }}">Trang Chủ</a>
                </li>

                {# ================== 2. LOGIC KIỂM TRA ĐĂNG NHẬP ================== #}
                {% if current_user.is_authenticated %}

                    {# --- A. MENU DÀNH CHO HỘI VIÊN (Không phải Nhân viên/HLV) --- #}
                    {% if not current_user.NhanVienProfile and not current_user.huanluyenvien %}
                        <li class="nav-item">
                            <a class="nav-link" href="{{ url_for('hoi_vien', taikhoan=current_user.taiKhoan) }}">
                                Dashboard
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="/lich-su-giao-dich">Lịch sử</a>
                        </li>
                    {% endif %}

                    {# --- B. MENU DÀNH CHO NHÂN VIÊN & ADMIN --- #}
                    {% if current_user.NhanVienProfile %}
                        <li class="nav-item">
                            {% if current_user.NhanVienProfile.vaiTro.name == 'NGUOIQUANTRI' %}
                                <a class="nav-link text-danger fw-bold" href="/admin">
                                    <i class="fas fa-cogs"></i> Quản Trị
                                </a>
                            {% else %}
                                <a class="nav-link" href="{{ url_for('thong_tin_nhan_vien', taikhoan=current_user.taiKhoan) }}">
                                    Dashboard NV
                                </a>
                            {% endif %}
                        </li>

                        {# Menu riêng cho Lễ Tân #}
                        {% if current_user.NhanVienProfile.vaiTro.name == 'LETAN' %}
                             <li class="nav-item">
                                <a class="nav-link" href="{{ url_for('staff_register') }}">Đăng Ký HV</a>
                            </li>
                        {% endif %}
                    {% endif %}

                    {# --- C. MENU DÀNH CHO HUẤN LUYỆN VIÊN --- #}
                    {% if current_user.huanluyenvien %}
                        <li class="nav-item">
                            <a class="nav-link" href="{{ url_for('danh_sach_hoi_vien') }}">
                                Quản Lý Hội Viên
                            </a>
                        </li>
                    {% endif %}

                    {# ================== 3. KHU VỰC CÁ NHÂN (USER NÀO CŨNG CÓ) ================== #}
                    <li class="nav-item ms-2">
                        <a class="nav-link fw-bold text-primary" href="{{ url_for('ho_so') }}">
                            <img src="{{ current_user.avatar if current_user.avatar else '/static/images/default-avatar.jpg' }}"
                                 class="rounded-circle border me-1"
                                 style="width: 25px; height: 25px; object-fit: cover;">
                            {{ current_user.hoTen }}
                        </a>
                    </li>

                    <li class="nav-item ms-2">
                        <a class="nav-link" href="{{ url_for('logout_process') }}">
                            Đăng Xuất
                        </a>
                    </li>

                {# ================== 4. CHƯA ĐĂNG NHẬP ================== #}
                {% else %}
                    <li class="nav-item">
                        <a class="nav-link" href="{{ url_for('login_process') }}">Đăng Nhập</a>
                    </li>
                    <li class="nav-item ms-2">
                        <a class="nav-link" href="{{ url_for('register') }}">
                            Đăng Ký
                        </a>
                    </li>
                {% endif %}
            </ul>
        </div>
    </div>
</nav>