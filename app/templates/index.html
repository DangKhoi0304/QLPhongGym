{% extends 'layout/base.html' %}

{% block title %}Trang chủ{% endblock %}

{% block content %}
<script src="{{ url_for('static', filename='js/main.js') }}?v=2"></script>

    <div class="container py-5" style="max-width: 1100px;">
        <div class="text-center mb-5">
            <h2 class="font-weight-bold text-uppercase" style="color: #444;">Các gói tập Gym</h2>

        </div>
        {% if packages %}
        <div class="row justify-content-center">
          {% for p in packages %}

            <div class="col-lg-4 col-md-4 col-sm-6 mb-4">

              <div class="card h-100 shadow-sm border-0 gym-card" style="border-radius: 15px; overflow: hidden;">

                <img class="card-img-top"
                     src="{{ url_for('static', filename='images/gym_default1.jpg') }}"
                     alt="{{ p.tenGoiTap }}"
                     style="height: 200px; object-fit: cover;">

                <div class="card-body d-flex flex-column text-center p-3">
                  <h5 class="card-title font-weight-bold text-dark">{{ p.tenGoiTap }}</h5>

                  <h4 class="text-primary font-weight-bold my-2">
                    {{ "{:,.0f}".format(p.giaTienGoi) }} VNĐ
                  </h4>

                  <p class="card-text text-muted small mb-3">
                    <i class="fa fa-clock-o"></i> Thời hạn: <strong>{{ p.thoiHan }} ngày</strong>
                  </p>

                  <div class="mt-auto">
                    {% if current_user.is_authenticated %}
                        <button type="button"
                                onclick="openPaymentModal({{ p.id }}, '{{ p.tenGoiTap }}', {{ p.giaTienGoi }}, {{ p.thoiHan }})"
                                class="btn btn-success btn-sm w-100 rounded-pill font-weight-bold shadow hover-effect">
                            <i class="fa fa-shopping-cart"></i> Đăng ký ngay
                        </button>
                    {% else %}
                        <a href="{{ url_for('login_process', next=request.full_path) }}"
                           class="btn btn-primary btn-sm w-100 rounded-pill">
                           Đăng nhập để mua
                        </a>
                    {% endif %}
                  </div>

                </div>
              </div>
            </div>
          {% endfor %}
        </div>
        {% else %}
        <div class="alert alert-danger mt-2">Không có sản phẩm nào!</div>
        {% endif %}

        <div class="modal fade" id="paymentModal" tabindex="-1" aria-hidden="true">
              <div class="modal-dialog modal-dialog-centered">
                <div class="modal-content" style="border-radius: 15px; overflow: hidden;">

                  <div class="modal-header bg-primary text-white">
                    <h5 class="modal-title font-weight-bold">Xác Nhận Đăng Ký</h5>
                    <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Close"></button>
                  </div>

                  <div class="modal-body p-4">

                    <div id="step-confirm">
                        <h4 class="text-center text-primary font-weight-bold mb-3" id="modalTenGoi">Tên Gói Tập</h4>

                        <div class="card bg-light border-0 mb-3">
                            <div class="card-body">
                                <div class="d-flex justify-content-between mb-2">
                                    <span class="text-muted">Giá tiền:</span>
                                    <span class="font-weight-bold text-danger fs-5" id="modalGiaTien">0 VNĐ</span>
                                </div>
                                <div class="d-flex justify-content-between mb-2">
                                    <span class="text-muted">Thời hạn:</span>
                                    <span class="font-weight-bold" id="modalThoiHan">0 ngày</span>
                                </div>
                                <hr>
                                <div class="d-flex justify-content-between">
                                    <span class="text-muted">Bắt đầu:</span>
                                    <span class="font-weight-bold text-dark" id="modalNgayBatDau">...</span>
                                </div>
                                <div class="d-flex justify-content-between">
                                    <span class="text-muted">Kết thúc:</span>
                                    <span class="font-weight-bold text-dark" id="modalNgayKetThuc">...</span>
                                </div>
                            </div>
                        </div>

                        <div class="alert alert-warning small">
                            <i class="fa fa-info-circle"></i> Tiền sẽ được trừ trực tiếp vào ví của bạn. Hành động này không thể hoàn tác.
                        </div>

                        <button type="button" onclick="submitPayment()" class="btn btn-success w-100 py-2 rounded-pill fw-bold shadow">
                            <i class="fa fa-check-circle"></i> XÁC NHẬN THANH TOÁN
                        </button>
                    </div>

                    <div id="step-success" style="display: none;" class="text-center">
                        <div class="mb-3">
                            <i class="fa fa-check-circle text-success" style="font-size: 5rem;"></i>
                        </div>
                        <h3 class="text-success font-weight-bold">Đăng Ký Thành Công!</h3>
                        <p class="text-muted">Cảm ơn bạn đã sử dụng dịch vụ. Gói tập đã được kích hoạt.</p>

                        <button onclick="location.reload()" class="btn btn-primary w-100 rounded-pill mt-3">
                            Đóng & Làm mới trang
                        </button>
                    </div>

                      <div id="step-error" style="display: none;" class="text-center">
                            <div class="mb-3">
                                <i class="fa fa-exclamation-triangle text-warning" style="font-size: 5rem;"></i>
                            </div>
                            <h4 class="text-warning font-weight-bold">Không Thể Đăng Ký!</h4>

                            <p class="text-secondary mt-3 px-3" id="errorMessage">...</p>

                            <button type="button" class="btn btn-secondary w-100 rounded-pill mt-4" data-bs-dismiss="modal">
                                Quay lại
                            </button>
                        </div>

                  </div>
                </div>
              </div>
            </div>

        {% if pages > 1 %}
        <div class="d-flex justify-content-center mt-4 mb-4">
            <ul class="pagination">
                {% for i in range(1, pages + 1) %}
                    <li class="page-item {% if request.args.get('page', 1)|int == i %}active{% endif %}">
                        <a class="page-link" href="/?page={{ i }}">{{ i }}</a>
                    </li>
                {% endfor %}
            </ul>
        </div>
        {% endif %}
    </div>
{% endblock %}